<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>Hello MUI</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<link rel="stylesheet" href="../css/mui.css">
		<link rel="stylesheet" href="../css/home/style.css" />
		<link rel="stylesheet" href="../css/home/reset.css" />
		<style>
			html,
			body {
				background-color: #efeff4;
			}
			
			.title {
				margin: 20px 15px 10px;
				color: #6d6d72;
				font-size: 15px;
			}
		</style>
		<link rel="stylesheet" href="../css/swiper.min.css" />
		<script type="text/javascript" src="../js/swiper.min.js"></script>
	</head>

	<body>
		<div class="in_header">
			<div class="in_head">
				<p style="display: none;"><img src="../images/yucheng/icon1.png"></p>
				<p>JADECHINA玉城</p>
				<p><img src="../images/icon/icon2.png" onclick="goSearch();"></p>
			</div>
		</div>
		<div>
			<div class="swiper-container slide_1" style="background:#080403;">
				<div class="swiper-wrapper  slide_ad">

				</div>
				<!-- Add Pagination -->
				<div class="swiper-pagination swiper_1"></div>
			</div>
		</div>

		<div class="in_blo1">
			<a href="home/goods_list_new.html">
				<p><img src="../images/yucheng/icon3.png"><i>新品推荐</i></p>
			</a>
			<a href="home/supplier_list.html">
				<p><img src="../images/yucheng/icon4.png"><i>商家推荐</i></p>
			</a>
			<a href="home/goods_list_time.html">
				<p><img src="../images/yucheng/icon5.png"><i>限时抢购</i></p>
			</a>
			<a href="home/goods_list_bought.html">
				<p><img src="../images/yucheng/icon6.png"><i>已卖鉴赏</i></p>
			</a>
		</div>
		<div class="in_blo2" style="margin:0;">
			<p>精品推荐</p>
			<p>RECOMMEND</p>
		</div>
		<div class="in_blo3">
			<div class="swiper-container slide_2">
				<div class="swiper-wrapper">
					<div class="swiper-slide" data="">
						<div class="in_new_block">
							<p class="in_block_img">
								<a data=""><img src="../images/in_6.jpg"></a>
							</p>
							<p class="in_block_cont">
								<b class="inbname">糯米飘扬绿冰种</b>
								<b class="inbprice">￥41000</b>
								<b class="inbshop">店名</b>
							</p>
						</div>
					</div>
					<div class="swiper-slide to_goods_detail">
						<div class="in_new_block">
							<p class="in_block_img">
								<a><img src="../images/in_6.jpg"></a>
							</p>
							<p class="in_block_cont">
								<b>糯米飘扬绿冰种</b>
								<b>￥41000</b>
								<b>店名</b>
							</p>
						</div>
					</div>
					<div class="swiper-slide to_goods_detail">
						<div class="in_new_block">
							<p class="in_block_img">
								<a><img src="../images/in_6.jpg"></a>
							</p>
							<p class="in_block_cont">
								<b>糯米飘扬绿冰种</b>
								<b>￥41000</b>
								<b>店名</b>
							</p>
						</div>
					</div>
					<div class="swiper-slide to_goods_detail">
						<div class="in_new_block">
							<p class="in_block_img">
								<a><img src="../images/in_6.jpg"></a>
							</p>
							<p class="in_block_cont">
								<b>糯米飘扬绿冰种</b>
								<b>￥41000</b>
								<b>店名</b>
							</p>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class='supplier_tpl'>

		</div>
		<script src="../js/mui.min.js"></script>
		<script type="text/javascript" src="../js/mui_utils.js"></script>
		<script type="text/javascript" src="../js/mui_ajax.js"></script>
		<script src="../js/zepto.min.js"></script>
		<script type="text/javascript">
			mui.init({
				swipeBack: true, //启用右滑关闭功能
				preloadPages: [{
					url: "./home/goods_detail.html",
					id: "./home/goods_detail.html",
					styles: {}, //窗口参数
					extras: {}, //自定义扩展参数
					subpages: [{}, {}] //预加载页面的子页面
				}, {
					url: "./home/supplier_home.html",
					id: "./home/supplier_home.html",
					styles: {}, //窗口参数
					extras: {}, //自定义扩展参数
					subpages: [{}, {}] //预加载页面的子页面
				}],
			});

			function goSearch() {
				//open with template and link to website address
				//var url = "http://www.jadechina.cn/mobile/goods_list.php?act=search";
				//mui_utils.openMuiPage('./link.html','openURL', {'openURL':url});
				//open local web page
				mui_utils.openMuiPage('./home/search.html');
			}

			var template_loaded = false;
			var preload_template = function(name, header, content) { //default, example/template.html, null;
				//var template = templates[name];
				if(!template_loaded) {
					//预加载共用父模板；
					template_loaded = true;
					var headerWebview = mui.preload({
						url: header,
						id: name + "-main",
						styles: {
							popGesture: "hide",
						},
						extras: {
							mType: 'main'
						}
					});
					//预加载共用子webview
					var subWebview = mui.preload({
						url: !content ? "../template_sub.html" : content,
						id: name + "-sub",
						styles: {
							top: '45px',
							bottom: '0px'
						},
						extras: {
							mType: 'sub'
						}
					});

					subWebview.addEventListener('loaded', function() {
						setTimeout(function() {
							subWebview.show();
						}, 50);
					});
					subWebview.hide();
					headerWebview.append(subWebview);

					//iOS平台支持侧滑关闭，父窗体侧滑隐藏后，同时需要隐藏子窗体；
					if(mui.os.ios) { //5+父窗体隐藏，子窗体还可以看到？不符合逻辑吧？
						headerWebview.addEventListener('hide', function() {
							subWebview.hide("none");
						});
					}
				}
			};

			function initSwipers() {
				var swiper1 = new Swiper('.slide_1', {
					pagination: '.swiper_1',
					loop: true,
					loopAdditionalSlides: 1,
					paginationClickable: true,
					spaceBetween: 30,
					loop: true,
					autoplay: 2000,
					autoplayDisableOnInteraction: false,
				});

				var swiper2 = new Swiper('.slide_2', {
					effect: 'slide',
					slidesPerView: 1.2,
					paginationClickabe: true,
					spaceBetween: 3,
					loop: false,
					loopAdditionalSlides: 1,
				});

				var swiper2 = new Swiper('.slide_3', {
					effect: 'slide',
					slidesPerView: 3,
					paginationClickabe: true,
					spaceBetween: 3,
					loop: false,
					loopAdditionalSlides: 1,
				});

			};

			mui.plusReady(function() {
				preload_template('default2', '../template.html');
				refresh();

			});

			function refresh() {
				console.log("refresh ----------------");
				mui.web_query('index.php', {
					waitingUI: false
				}, function(data) {
					var baseurl = 'http://www.jadechina.cn/';
					if(data.wap_index_ads) {
						$.each(data.wap_index_ads, function(idx, goods) {

								var lunBoImg = "<div class='swiper-slide' data='" + idx + "'><img src='" + baseurl + "" + goods.image + "'></div> ";
								$(".slide_ad").append(lunBoImg);
							}) //end each
					}
					if(data.is_best) {
						var list = $('.slide_2').children().eq(0);
						var tpl = list.children().eq(0);
						//						console.log(tpl[0]);
						list.empty();
						for(var i in data.is_best) {
							var obj = data.is_best[i];
							var newItem = tpl.clone();
							//newItem.find('a').attr('href',baseurl + obj.goods_thumb)
							//console.log(baseurl + obj.goods_thumb);
							//							newItem.find('a').attr('href', obj.goods_id);
							newItem.find('a').attr('data', obj.goods_id);
							newItem.find('img').attr('src', baseurl + obj.goods_thumb);
							newItem.find('.swiper-slide').attr('data', obj.goods_id);
							newItem.find('.inbname').html(obj.goods_name);
							newItem.find('.inbprice').html(obj.shop_price);
							newItem.find('.inbshop').html(obj.supplier_name);
							newItem.appendTo(list);
						}
					}

					if(data.cat_recommend_new) {
						//console.log(data.cat_recommend_new);
						$.each(data.cat_recommend_new, function(idx, item) {
							//console.log(item.region_name + '//' + item.region_id); 
							//<option value="6">广 东</option>
							//var str = '<option value=' + item.region_id + '>' + item.region_name + '</option>';
							var type_list1_html =
								"<div class='in_blo4' style='position: relative;' data='" + item.cat_id + "'>" +
								"<p class='sty_name'>" + item.cat_name + "</p>" +
								"<img src='" + baseurl + "" + item.img + "' class='to_goods_detail'>" + 
								"</div>"+
									"<div class='in_blo'>" +
									"<div class='swiper-container slide_3'>" +
									"<div class='swiper-wrapper'>" ;								
								
							$.each(item.goods, function(n, item_low) {

								var type_list2_html =

									
									"<div class='swiper-slide' data='" + item_low.goods_id + "'>" +
									"<div class='in_change_block' style='background: #f2f2f2;'>" +
									"<p class='in_change_img'><a><img src='" + baseurl + "" + item_low.goods_thumb + "'></a></p>" +
									"<p class='in_change_cont'>" +
									"<b>" + item_low.goods_name + "</b>" +
									"<b>￥" + item_low.shop_price + "</b>" +
									"</p>" +
									"</div>" +
									"</div>";

									
								type_list1_html += type_list2_html;
							})
							type_list1_html +=
								"</div>" +
									"</div>" +
									"</div>";
							$(".supplier_tpl").append(type_list1_html);
							//console.log(type_list1_html);
						})

					}
					initSwipers();
					mui.fire(plus.webview.currentWebview().opener(), 'homeready')
				})
			}
			var tpl;

			function getTemplate() {
				if(!tpl) {
					/*var array = plus.webview.all();
					if(array){
						for(var i=0,len=array.length;i<len;i++){
						    	console.log(array[i].getURL());
						    	console.log(array[i].id);
					        }
					}*/
					tpl = plus.webview.getWebviewById('default2-main');
				}
				return tpl;
			}
			mui('.in_blo1').on('tap', 'a', function() {
				var tpl = getTemplate(); //使用template显示页面
				var id = this.getAttribute('href');
				var href = this.href;
				console.log($(this).find('i')[0].innerText);
				var title = $(this).find('i')[0].innerText.trim();
				mui.fire(tpl, 'updateHeader', {
					title: title,
					showMenu: false,
					target: href,
					aniShow: 'slide-in-right'
				});
			});

			mui(".in_blo3").on('tap', 'a', function() {
				var tpl = getTemplate();
				var id = this.getAttribute('data');
				console.log(id);
				var wv = plus.webview.getWebviewById('./home/goods_detail.html');
				if(wv) {
					wv.show('slide-in-right');
					mui.fire(wv, 'setid', {
						id: id
					})
				}
			});

			mui(".supplier_tpl").on("tap", '.swiper-slide', function() {
				var id = this.getAttribute('data');
				console.log('goodsid ' + id);
				var wv = plus.webview.getWebviewById('./home/goods_detail.html');
				if(wv) {
					wv.show('slide-in-right');
					mui.fire(wv, 'setid', {
						id: id
					})
				}
			})

			mui(".supplier_tpl").on("tap", '.in_blo4', function() {
				//alert(1);
				var id = this.getAttribute('data');
				console.log('supplierid ' + id);
				//商铺首页
				toUrl(id);
				//var wv = plus.webview.getWebviewById('./home/supplier_home.html');
			
			})
		function toUrl(cat_id)
					{		 
						var wv = plus.webview.getWebviewById('./goods_attr/goods_list_filter.html');
						if (wv){
							wv.show('slide-in-right');
							mui.fire(wv, 'set_id', {id:cat_id});
						}
					}			
		</script>
	</body>

</html>
